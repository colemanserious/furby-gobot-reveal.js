<!doctype html>
<html lang="en">

	<head>
		<meta charset="utf-8">

		<title>Furby: "Go" away!</title>

		<meta name="description" content="A walk through Go programming via the Gobot framework.  We connect a Furby up via Raspberry Pi through Gobot to let programmers be yelled out by a Furby when a Jenkins job breaks.">
		<meta name="author" content="Tina Coleman @colemanserious">

		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">

		<link rel="stylesheet" href="css/reveal.css">
		<link rel="stylesheet" href="css/theme/league.css" id="theme">
		<link rel="stylesheet" href="css/furby.css">

		<!-- Code syntax highlighting -->
		<link rel="stylesheet" href="lib/css/zenburn.css">

		<!-- Printing and PDF exports -->
		<script>
			var link = document.createElement( 'link' );
			link.rel = 'stylesheet';
			link.type = 'text/css';
			link.href = window.location.search.match( /print-pdf/gi ) ? 'css/print/pdf.css' : 'css/print/paper.css';
			document.getElementsByTagName( 'head' )[0].appendChild( link );
		</script>

		<!--[if lt IE 9]>
		<script src="lib/js/html5shiv.js"></script>
		<![endif]-->
	</head>

	<body>

		<div class="reveal">

			<!-- Any section element inside of this container is displayed as a slide -->
			<div class="slides">
				<section data-background="img/8317241259_e0cde4b40a_b.jpg" data-state="dim">
					<h1>Furby: "Go" Away!</h1>
					<h3>Jenkins Furby Ravings via Gobot and Go</h3>
					<p>&nbsp;</p>
					<p>&nbsp;</p>

					<p>
						Furby zoology by <a href="http://www.nerderypublic.com">Tina Coleman</a> | <a href="http://twitter.com/colemanserious">@colemanserious</a> |
						<a href="mailto:tina@haydensoft.com">tina@haydensoft.com</a>
					</p>
					<aside class="notes">

				Image: <a href="https://creativecommons.org/licenses/by/2.0/">Some rights reserved</a> by <a href="https://www.flickr.com/photos/whatleydude">@whatleydude</a> 
					</aside>
				
				</section>

				<section>	
				<h2>History of Furby</h2>
				
				<ol>
					<li>1998: Furby enters the market
					<li>2005: Emoto-tronic Furby, "Furby Island" TV show
					<li>2012: Resurge of the Furby: now with iOS and Android Apps
					<li>2013: 2 Coleman daughters receive Furbies
				    <li>2014: "Arduino + Furby Broken Build Notification - Oh, You'll Want to Fix It Quick!"
					<li>2015: Chewbacca Furby	
					<li>tomorrow... a Furby SkyNet 
				</ol>	

						<aside class="notes">
						Dave Hampton and Caleb Chung - nine months to create the Furby before it appears at the American International Toy Fair in 1998 - citation: http://furbytoyshop.com/furby-history, https://en.wikipedia.org/wiki/Furby

						Image: <a href="https://creativecommons.org/licenses/by/2.0/">Some rights reserved</a> by <a href="https://www.flickr.com/photos/donhomer/">Michael Bentley</a>
						</aside>
				</section>

				<section data-background="img/8322201790_c303417e89_z.jpg">
					<p>&nbsp;</p>
					<p>&nbsp;</p>
					<p>&nbsp;</p>
					<p>&nbsp;</p>

				<h1>Feel my Furby wrath</h1>
				</section>

				<section>
					<h2>What.. ?  and WHY??</h2>
					<p>
					<span class="fragment">Furby for broken code...  <em> Why Not?</em></span>
					</p>
					<p><span class="fragment">Raspberry Pi...  <em>Because I had one</em></span></p>
					<span class="fragment"><p>Gobot...  <em>their logo's cool!</em></p><img src="img/gopher.png"></span>
					<br><span class="fragment">OK, and so is Golang</span>
					
						<aside class="notes">
						Other build indicators: emails, slack messages, glowing spheres, Nerf guns...  	
						Raspberry Pi - already had an Arduino which I'd done some experimenting with...  always a good idea to try something new, particularly when a conference topic hangs in the balance

						Gobot - well, cool logo, plus I'd gotten to do some Golang at work and wanted to poke around a bit more...  

						Gobot logo: http://gobot.io/images/elements/gopher.png
						</aside>
				</section>
				<section >
					<h2>Labor of Love</h2>
					<a href="http://github.com/colemanserious/furby-gobot">http://github.com/colemanserious/furby-gobot</a>
					<img src="img/9990571563_2d90ca7168_z.jpg" height="70%" />
					
					<aside class="notes">
					Image: <a href="https://creativecommons.org/licenses/by/2.0/">Some rights reserved</a> by <a href="https://www.flickr.com/photos/stevensnodgrass/9990571563">Stephen Snodgrass</a>
				</section>

				<section data-background="img/gophercolor.png"  data-state="dim shift-down" data-background-size="500px 500px" >
					<h2>Go</h2>
					<ul>
						<li>Smart coworker
						<li>Docker 
						<li>Build smaller modules 
						<li>Fast compile + build time
						<li>Functions as first-class citizens
						<li>Concurrency handling
						<li>Active community
						<li>Built in tooling
					</ul>
					
					<p></p>
					<h4>Enough to go see what all the fuss is about</h4>
					<aside class="notes">
					The Go gopher was designed by Renee French. (http://reneefrench.blogspot.com/)
	     			The design is licensed under the Creative Commons 3.0 Attributions license.
	     			Read this article for more details: https://blog.golang.org/gopher	
	     			</aside>
				</section>

				<section data-background="img/gobot-home.png" data-state="shift-down" data-background-size="300px 300px">
					<h2>Gobot</h2>
					<ul>	
						<li>Platforms:  Raspberry Pi, BeagleBone, Sphero, Arduino, ...
						<li> Devices
							<ul>
								<li>GPIO
								<li>I2C
							</ul>
						<li>Related projects:<br />
						<img src="img/artoo.png" /> &nbsp; &nbsp;
						<img src="img/cylon.png" /> 
					</ul>
					<aside class="notes">
					- All use same adaptor / driver pattern
					- There are some odd things as platforms; joysticks, keyboard, Leap motion
					- Cylon appears to have more "connectors" than Gobot, but able to beg/borrow ideas from all projects
					- Taking a look at the platforms, added a few more things to my Amazon WishList!
					</aside>
					
				</section>

				<section>
					<h2>How DO you control a Furby?</h2>
					<a href="http://dgst201.maryclark.us/hacking/silencing-furby/">Annotated Furby schematics</a>
					<img src="img/_furby_alt_schematic.jpg" />
					<aside class="notes">
						* So, Furby's not listed in the set of things that Gobot (or Artoo or Cylon) command...  
						* Instructables to take it apart
						* Motor mechanisms...	

					Image source: http://dgst201.maryclark.us/hacking/silencing-furby/. Blog: MARY CLARK: TINKERING, HACKING, AND MAKING, post as of March 29, 2016.  Linked from http://www.kellyheatonstudio.com/reflection-loop-1
					</aside>
				</section>

				<section>
					<h2>OR...</h2>
					<img src="img/FurbyGobotPi.svg" height="80%" width="80%" />	
					<aside class="notes">
						github.com/iafan/Hacksby - perl project which documents / produces WAV files used to trigger furby
				</section>

				<section>
					<h2>Playing a Sound</h2>
					<pre>
					<code data-trim>
// PlayWav plays the filename provided.
//  Potential errors include:
//   - file not found
//   - unable to play
//
// Note: Did see audio package in GoLang, however its part of gomobile
//  Other alternatives exist - OpenAL, portaudio, ...  aplay seemed simplest
func PlayWav(fileName string) (err error) {

        if fileName == "" {
                log.Println("Require filename for WAV file.")
                return errors.New("Requires filename for WAV file.")
        }

        // command to play a WAV file on Raspberry Pi
        cmd := exec.Command("aplay", fileName)
        err = cmd.Run()

        if err != nil {
                log.Println(err)
                return err
        }

        // Need to return to fulfill function sig, even though returning an empty
        return
}
					</code>
					</pre>
					
					<aside class="notes">
					- "PlayWav" is public within the package.  See also Command and Run being public.  exec is from package os/exec, which is referred to as its "final" name
					- Common go convention to return err (or array of errors), rather than throw an exception
					- Not yet integrated into Gobot, but this is the basis of what we're doing... 
					</aside>
	
				</section>

				<section>
					<h2>Trying it out - console app</h2>
					<a href="https://github.com/spf13/cobra">spf13/cobra</a> - "A Commander for Modern Go CLI interactions"

					
					<pre>
					<code>
cobra init
cobra add playSound
					</code>
					</pre>

					<aside class="notes">
					Session earlier this week on Go CLI...  if you didn't catch it, see if it's recorded
					</aside>
				</section>

				<section>
					<h2>playSound command</h2>


Within cmd/playSound.go...
					<pre>

					<code>
var playSoundCmd = &cobra.Command{
        Use:   "playSound",
        Short: "Play a sound file given as an argument.",
        Run: func(cmd *cobra.Command, args []string) {

                if len(args) == 0 {
                        log.Println("Must provide filename")
                        return
                }
                err := sounds.PlayWav(args[0])
                if err != nil {
                        log.Println("Unable to execute command - could not play sound.")
                }
        },
}

func init() {
        RootCmd.AddCommand(playSoundCmd)

}

					</code>
					</pre>
					<aside class="notes">
					./furby-gobot playSound resources/match2.wav
					Work done to put Audio into an adaptor and driver for Gobot
					</aside>
				</section>

				<section>
					<h2>Audio Driver / Adaptor</h2>
					Receive requests to play quickly, but only play 1 at a time...<br/>
					Don't block channel, though we might drop playing sounds
					<pre>
						<code>
func (d *AudioDriver) Start() (err []error) {
        go d.serve(d.queue)
        return
}

// See example at https://golang.org/doc/effective_go.html#concurrency
// Purpose: receive messages on channel, but throttle execution of playing
func (d *AudioDriver) serve(queue chan string) {
        for req := range queue {
                sem <- 1
                go func(req string) {
                        fmt.Printf("Playing sound %v\n", req)
                        // d.Sound is on Adaptor, which 
                        //  calls aplay using similar logic as PlayWav
                        d.Sound(req)
                        <-sem
                }(req)
        }
}

						</code>
					</pre>
					<aside>
						Audio is now being added to Gobot, based on work seen here.  This was modeled after the Audio Driver seen in Cylon.
						"if Cylon.js is the future, than Gobot is the future's future" - Ron Evans, @deadprogram, developer at Hybrid Group, the primary maintainers of Gobot
						There's now a feature/audio branch in Gobot, which provides support for mp3s, as well as WAV files
					</aside>
				</section>


				<section>
					<h2>Basic Gobot - Light up LED + sound</h2>
					See cmd/ledOn.go
					<pre>
					<code>
gbot := gobot.NewGobot()

r := raspi.NewRaspiAdaptor("raspi")
audioAdaptor := audio.NewAudioAdaptor("sound")

// Gobot maps the pin to the GPIO pin
led := gpio.NewLedDriver(r, "led", "33")

audioDriver := audio.NewAudioDriver(audioAdaptor, "sounds", nil)
         
work := func() {
	gobot.Every(5*time.Second, func() {
	        led.Toggle()
	        audioDriver.Sound("resources/foo.wav")
	})
}

robot := gobot.NewRobot("furbyBot",
    []gobot.Connection{r, audioAdaptor},
    []gobot.Device{led, audioDriver },
    work,
)
					</code>
					</pre>

					<aside class="notes">
						No communications going on between the various components, but GoBot is controlling all of the elements...
					</aside>
				</section>

				<section>
				<h2>Driving via the web</h2>
					<code>
					api.NewAPI(gbot).Start()
					</code>

					<p>&nbsp;</p>
					<p>Any commands on drivers are exposed, as well as events


				</section>

				<section>
				<h2>Web driven</h2>
					<p>Use :3000/ to interact with your robot</p>

					<img src="img/Robeaux.png" />

					<aside class="notes">
						http://192.168.2.2:3000
					</aside>
				</section>

				<section>
				<h2>Integrating info from Jenkins into Gobot</h2>
				Part I: Receive the info.
				<pre>
				<code>
j.AddEvent(JobResult)

j.AddCommand("ParseResults", func(params map[string]interface{}) 
	interface{} {
    var snapshot JobOutcomeSnapshot

    result := ParseJobState(params)
    if (JobOutcome{}) != result {
        fmt.Printf("Result: %v\n", result)
        lastOutcome, ok := jobStates[result.Name]
        if ok {
                fmt.Printf("Last outcome: %v\n", lastOutcome)
        }

        snapshot.Outcome = result
        snapshot.RanAt = time.Now()
        jobStates[result.Name] = snapshot
        gobot.Publish(j.Event(JobResult), result)
    }

    return result
})

				</code>
				</pre>
				<aside class="notes">

				All of the above is within my custom jenkinsconnect driver.  Modeled after MQTT...  basically, subscribing to events from Jenkins
				if (JobOutcome{} != result) =>  Did I return a non-empty JobOutcome?  

				gobot.Publish()
				</aside>
				</section>

				<section>
				<h2>Integrating info from Jenkins into Gobot</h2>
				Part II: Do something with it...

				</section>

				<section data-background="img/manyFurbies.jpg" data-state="dim">
				<h2>Oh Developers...</h2>
				
				<p>
						<a href="http://www.nerderypublic.com">Tina Coleman</a> | <a href="http://twitter.com/colemanserious">@colemanserious</a> |
						<a href="mailto:tina@haydensoft.com">tina@haydensoft.com</a>
				</p>
				
				</section>
			</div>

		</div>

		<script src="lib/js/head.min.js"></script>
		<script src="js/reveal.js"></script>

		<!-- Required for sampler.js! -->
       <script   src="https://code.jquery.com/jquery-2.2.3.min.js"   integrity="sha256-a23g1Nt4dtEYOj7bR+vTu7+T8VP13humZFBJNIYoEJo="   crossorigin="anonymous"></script>

		<script>

			// Full list of configuration options available at:
			// https://github.com/hakimel/reveal.js#configuration
			Reveal.initialize({
				controls: true,
				progress: true,
				history: true,
				center: true,

				transition: 'slide', // none/fade/slide/convex/concave/zoom

				// Optional reveal.js plugins
				dependencies: [
					{ src: 'lib/js/classList.js', condition: function() { return !document.body.classList; } },
					{ src: 'plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: 'plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: 'plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } },
					{ src: 'plugin/zoom-js/zoom.js', async: true },
					{ src: 'plugin/notes/notes.js', async: true },
					{ src: 'plugin/reveal-sampler-master/sampler.js'}
				]
			});

		</script>

	</body>
</html>
